"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = get_request_signature;

var _crypto = _interopRequireDefault(require("crypto"));

function get_path(url) {
  var url_info = new URL(url);
  return url_info.pathname + url_info.search;
}

function get_request_signature(url, http_verb, content, headers, secret) {
  if (http_verb === "GET") {
    return "";
  }

  var content_md5 = _crypto["default"].createHash("md5").update(content).digest("hex");

  var request_uri = get_path(url);
  var sign_string = http_verb + "\n" + content_md5 + "\n" + headers["Content-Type"] + "\n" + headers["Date"] + "\n" + request_uri;

  var hash = _crypto["default"].createHmac("sha256", secret).update(sign_string);

  return hash.digest("base64");
}

module.exports = exports.default;